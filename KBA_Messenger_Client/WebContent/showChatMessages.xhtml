<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition template="/META-INF/templates/projektTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">

	<ui:param name="title" value="Messenger - Chat" />

	<ui:define name="content">

		<h2>
			<h:outputText value="Chat: #{chatBean.chat.getName()}" />
		</h2>
		<h3>
		User:  
		<ui:repeat value="#{chatBean.chat.getUsers()}" var="user">
				#{user.getUsername()},
		</ui:repeat>
		</h3>
		
		<p:button value="Chatliste öffnen" id="back"
							 outcome="back" icon="ui-icon-arrowthick-1-w"  />
		<h:form id="formMessages">
			<p:layout style="min-width:300px;min-height:300px;" >

				<p:layoutUnit position="center" header="#{chatBean.chat.getName()}">
				<h:form id="messages">
					<ui:repeat value="#{communicationBean.messageList}" var="message">
					<h:outputText value="#{message.getTimestamp()}" >
					    <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
					</h:outputText>
				- #{message.getSender().getUsername()} 
				- #{message.getText()} <br/>
					</ui:repeat> 
					<div id="bottomDiv"></div>
				</h:form>
					
				</p:layoutUnit>


				<p:layoutUnit position="south">
					<h:form id="sendMessage">
						<p:panelGrid columns="3">
							<p:inputText id="messageInput" required="true" label="Message Input" size="50" value="#{communicationBean.messageText}"/>
							<p:commandButton value="Senden"
								for="messageInput"
								action="#{communicationBean.sendMessage()}"
								update="formMessages sendMessage" 
								oncomplete="scrollToBottom()"/>
						</p:panelGrid>
					</h:form>
					<p:commandButton value="Aktualisieren " id="refresh" action="#{chatBean.refreshChat()}" update="messages" icon="ui-icon-circle-plus" oncomplete="scrollToBottom()"  />
				</p:layoutUnit>
				
				<p:layoutUnit position="east">
					<p:panelGrid id = "panel" columns="1" border = "1" rendered="#{chatBean.getChat().isGroupChat()==true}">
						<p:button id="show"
										 value="Informationen anzeigen" 
										 title="Einstellung anzeigen"
										 outcome="showInfo"/>
						<p:button 	rendered='#{chatBean.getChat().getAdmin().getUsername()==userBean.getUser().getUsername()}'
											action="#" id="edit"
										 	value="Einstellungen ändern"
										 	title="Einstellung ändern"
										 	outcome="settings"/>
						<p:commandButton rendered='#{chatBean.getChat().getAdmin().getUsername()==userBean.getUser().getUsername()}'
											action="#" id="löschen"
										 	value="Chat löschen" title="Chat löschen"/>
					</p:panelGrid>
					</p:layoutUnit>

			</p:layout>
		</h:form>
		
		
		<script type="text/javascript">             
			function scrollToBottom() {
				window.location.hash = '#bottomDiv';
			}
		</script>
		

	</ui:define>

</ui:composition>